@page "/fibonacci"
@using System.Numerics
@rendermode InteractiveServer

<PageTitle>Fibonacci Sequence</PageTitle>

<h3>Fibonacci Sequence Challenge</h3>

<div class="row my-3">
    <div class="col-md-2">
        <label>Run numbers up to:</label>
        <input type="number" class="form-control" @bind="x" />
    </div>

    <div class="col-md-2">
        <label>Y Value:</label>
        <input type="number" class="form-control" @bind="y" />
    </div>
    <div class="col-md-2">
        <label>Z Value:</label>
        <input type="number" class="form-control" @bind="z" />
    </div>

    <div class="col-md-2 d-flex align-items-end">
        <button class="btn btn-primary btn-align-end" @onclick="RunLoop">Run</button>
    </div>
</div>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="alert alert-danger">@errorMessage</div>
}

<div class="results-container" style="height: 500px; overflow-y: auto; border: 1px solid #ccc;">
    <Virtualize Items="@Output" Context="result">
        <div class="result-item" >
            @result
        </div>
    </Virtualize>
</div>

@code {
    private int? x { get; set; } = 6;
    private int? y { get; set; } = 1;
    private int? z { get; set; } = 2;

    private string? errorMessage;
    private List<string> Output { get; set; } = new List<string>();

    private void RunLoop()
    {
        Output.Clear();
        errorMessage = null;

        // x has to be arbitrarily capped to avoid performance issues
        if (x > 10000)
        {
            errorMessage = "Limiting iterations to 10,000 to ensure a smooth UI experience.";
            x = 10000;
        }
        // Error checking
        if (x == null || x <= 0)
        {
            errorMessage = "Please enter a valid positive integer for X value [ x > 0].";
            return;
        }
        if (y == null || y <= 0)
        {
            errorMessage = "Please enter a valid positive integer for Y value [ y > 0].";
            return;
        }
        if (z == null || z <= 0)
        {
            errorMessage = "Please enter a valid positive integer for Z value [ z > 0].";
            return;
        }

        for (int i = 0; i < x.Value; i++)
        {
            int index1 = i - y.Value;
            int index2 = i - z.Value;

            Output.Add((index1 < 0 || index2 < 0) ? "1" : (BigInteger.Parse(Output[index1].Replace(",","")) + BigInteger.Parse(Output[index2].Replace(",",""))).ToString("N0"));
        }
    }
}
